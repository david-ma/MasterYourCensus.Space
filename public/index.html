<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Master Your Census</title>

<style>

body {
	background-color: #eee;
}

.page {
	/*background-color: #fff;*/
	background: rgba(0,0,0,0.1);
}

header {
	width: 100%;
	/*height: 200px;*/
	background: #333e52;
}
header .blur_background {
	/*height: 200px;*/
	width: 100%;
	position: absolute;
	background-size: cover;
	background-position: 50% 60%;
}
footer {
	width: 100%;
	height: 50px;
	background: #ddd;
	position: fixed;
	bottom: 0;
}

.mask {
	height: 100%;
	background: linear-gradient(rgba(0,0,0,0),rgba(0,0,0,0.3), rgba(0,0,0,0.5));
}

header .container {
	padding-top: 100px;
}

header h1 {
	font-size: 60px;
	color: #eee;
	margin: 0;
}
header h2 {
	font-size: 30px;
	color: #eee;
	margin: 0;
}

#answers a {
	padding: 5px;
	margin: 5px;
	float: left;
	min-width: 50px;
	text-align: center;




	color: #FFF;
	background-color: #0095ff;
	border-color: #07c;
	box-shadow: inset 0 1px 0 #66bfff
}

#answers a:hover,
#answers a:focus,
#answers a:active {
	color: rgba(255,255,255,0.9);
	background-color: #07c;
	border-color: #005999;
	box-shadow: inset 0 1px 0 #3af;
}
#gameStuff {
	height: 100%;
}
#gamePane {
	/*height: 100%;*/
	/*background: rgba(0,0,0,0.1);*/
}
#quizStuff {
	padding-left: 15px;
	/*background: rgba(0,0,0,0.1);*/
}

#globe {
	width: 100%;
	padding: 10px;
}




/*MOBILE STUFF*/
@media (max-width: 768px){
	body {
	}
	#globe {
		margin: auto;
		padding: 2px;
	}
	header .container {
		padding-top: 20px;
	}
	header h1 {
		font-size: 30px;
		/*text-align: center;*/
	}
}

.hide {
	display: none;
}
#winners {
	margin-top: 20px;
	margin-bottom: 50px;
}
tr:first-child {
	background: rgba(0,0,0,0.2);
}

td {
	border: 1px solid black;
	width: 150px;
	background: rgba(0,0,0,0.1);
	text-align: center;
}
#infoPane {
	background: #eee;
}

#submitButtonBox {
	background: pink;
	color: black;
	font-weight: 900;
}

#submitButtonBox {
	background: lightblue;
}

#currentScore h3 {
	background: white;
	padding: 5px 25px;
}

#tally {
	float: right;
}

</style>
</head>
<body>
	<header>
		<div class="blur_background">
			<div class="mask"></div>
		</div>
		<div class="container">
			<div class="row">
				<!--<div class="col-sm-2 col-sm-offset-0 col-xs-8 col-xs-offset-2 ">-->
				<div class="col-xs-2">
					<img id="globe" src="/images/earth-globe.png">
				</div>
				<div class="col-xs-10">
				<!--<div class="col-sm-10 col-xs-12">-->
					<h1>Master Your Census</h1>
					<!--<h2>Category: <span id="category">All</span> Location: <span id="location">All</span></h2>-->
				</div>
			</div>
		</div>
	</header>

	<div class="container page">
		<div class="row hide" id="gameoverStuff">
			<div class="col-sm-8 col-sm-offset-2">
			<table id="winners">
				<tr>
					<td>Name</td>
					<td>School</td>
					<td>Score</td>
				</tr>
			</table>
			</div>
		</div>
		<div class="row" id="gameStuff">
			<div id="gamePane" class="col-xs-12 col-sm-8">
				<div id="quizStuff" class="row col-xs-12">
					<h3 id="question"></h3>
					<div id="answers"></div>
				</div>

				<div id="scoreStuff" class="row col-xs-12">
					<div id="currentScore">
						<h3>Score <span id="tally">0</span></h3>
					</div>


					<div class="col-xs-6">
						<h3><a href="#showLeaderboard" onclick="endgame()">Leaderboard</a></h3>
					</div>
					<div id="pastquestions" class="col-xs-6 hide">
						<h3>Previous Question!</h3>
						<p id="pastQuestion"></p>
						<p id="pastAnswer"></p>
					</div>
				</div>
			</div>


			<div id="infoPane" class="col-xs-12 col-sm-4">
				<h3>Challenge</h3>
<p>Census data is vital to policy decision in Australia, and yet many people don't know how to access it or use it. Census data is presented as PDFs and tables, but non-technical people won't really engage with it</p>
				<h3>Solution</h3>
<p>We've created an engaging Census quiz that hooks people in using elements of gamification. We focused on educating the younger generation, incorporating a school competition and leaderboard to incentivise them to keep playing and learning about the Census!</p>
				<h3>Team</h3>
					<ul>
						<li><a href="https://au.linkedin.com/in/aidan-majewski">Aidan Majewski</a></li>
						<li><a href="https://twitter.com/smitingshark">Beverly Goh</a></li>
						<li><a href="https://twitter.com/frostickle">David Ma</a></li>
						<li><a href="https://twitter.com/_TimMcMahon">Tim McMahon</a></li>
						<li><a href="https://twitter.com/turtlevince">Vincent Leung</a></li>
					</ul>
			</div>



		</div>
	</div>




	<!--<footer>-->
		<!--<div class="container">-->
			<!--<div class="row">-->
				<!--<p class="col-xs-6">Simple <a href="https://github.com/david-ma/Thalia">Thalia</a> Bootstrap Boilerplate</p>-->
				<!--<p class="col-xs-6 text-right">By <a href="https://twitter.com/frostickle">@Frostickle</a> <i class="fa fa-twitter" aria-hidden="true"></i></p>-->
			<!--</div>-->
		<!--</div>-->
	<!--</footer>-->





	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/jquery-ui.min.css">
	<link rel="stylesheet" href="/css/jquery-ui.structure.min.css">
	<link rel="stylesheet" href="/css/jquery-ui.theme.min.css">
	<link rel="stylesheet" href="/css/main.css">
	<script src="/js/vendor.min.js"></script>
	<script src="/js/scripts.min.js"></script>

	<script src="/js/d3-v4.min.js"></script>
	<script src="/js/d3-selection-multi.v1.min.js"></script>
	<script src="/js/jquery-ui.min.js"></script>




<script>
var score = 0;
var questions = [];
newQuestion();
//newQuestion("/v2-slider.json");
//newQuestion("/v2-normal.json");




function newQuestion(url) {
//	var url = url || "http://www.masteryourcensus.space/v3/newQuestion.json";
	var url = url || "http://www.masteryourcensus.space/api/question3.php?id=1";


	var package = {
		"test": "Hello World"
	};

	$.ajax({
		type: "POST",
		url: url,
		contentType: "application/json; charset=utf-8",
		dataType: "json",
		data: JSON.stringify(package),
		complete: function(response){
			if (response.status && response.status == 200) {
				var data = JSON.parse(response.responseText);


				if(questions[0]) {
					var past = questions[questions.length - 1];

					var ans = past.correctAnswer;
					if(past.type == "Slider") {
						ans += " "+past.unit;
					}

					$("#pastquestions").removeClass("hide");
					$("#pastQuestion").text(past.question);
					$("#pastAnswer").text(ans);

				}


				questions.push(data);

//				console.log(data);
				if(data.type == "Slider") {
					drawSlider(data);
				} else {
					drawNormalQuestion(data);
				}

			} else {
				console.log("The first attempt didn't work... calling the local version");
				console.warn(response);
				newQuestion("/v2-slider.json");
			}
		}
	});
}


function drawSlider(data) {
	var answerBox = setupQuestion(data);

	answerBox.append("div").attrs({
		id: "slider"
	}).styles({
		margin: "5px 0"
	});

	answerBox
		.append('p')
		.append("input").attrs({
			style: "border:0; color:#f6931f; font-weight:bold;",
			id: "amount",
			type: "text",
			readonly: true
		});

	$( "#amount" ).val( data.min + " " + data.unit);

	answerBox
		.append("a").classed("answer", true)
		.attr('href', '#')
		.text("Submit")
		.on("click", checkAnswer);

	$( "#slider" ).slider({
//		range: "min",
		value: data.min,
		min: data.min,
		max: data.max,
		slide: function( event, ui ) {
			$( "#amount" ).val( ui.value + " " + data.unit);
		}
	});


}

function setupQuestion(data) {
	console.log("Setting up new question");
	console.log(data);
	d3.select("#question").text(data.question);
	var answerBox = d3.select("#answers")
			.append("div")
			.attrs({
				id: "answerBox"
			}).datum(data);
	return answerBox;
}


function drawNormalQuestion(data) {
	var answerBox = setupQuestion(data);

	var correctAnswer = data.correctAnswer;
	data.otherAnswers.push(correctAnswer);

	shuffle(data.otherAnswers).forEach(function(answer){
		answerBox
			.append("a").classed("answer", true)
				.attr("correctAnswer", correctAnswer)
				.attr('href', '#')
				.text(answer)
			.on("click", checkAnswer);
	});
}

function checkAnswer() {
	console.log("checking answer!");
	console.log(this);
	var correctAnswer = d3.select(this).attr("correctAnswer");
	var buttonAnswer = d3.select(this).text();

	var data = d3.select("#answerBox").datum();

	if(data.type == "Slider") {
		console.log("dealing with a slider here");
		var answer = parseInt($("#amount").val());
		var threshold = data.threshold || 20;

		if(answer < correctAnswer + threshold && answer > correctAnswer - threshold) {
			correct();
		} else {
			wrong();
		}



	} else {
		console.log("normal question");
		if(correctAnswer == buttonAnswer) {
			correct();
		} else {
			wrong();
		}
	}


}

function wrong() {
	console.log("wrong answer");
	if(confirm("Wrong answer! Continue?")) {
		correct();
	} else {
		endgame();
	}
}

function correct(){
	score++;
	d3.select("#tally").text(score);
	d3.select("#answerBox")
		.transition()
		.style("padding-left", "2000px")
		.on("end", function(){
			d3.select("#answerBox").remove();
			newQuestion();
			d3.select("#quizStuff").style("padding-left", "15px");
			console.log("end");
		});
}

function endgame() {
	$("#gameoverStuff").toggleClass("hide");
	$("#gameStuff").toggleClass("hide");

	$.ajax({
		type: "GET",
		url: "http://www.masteryourcensus.space/api/leaderboard.php",
		complete: function(response){
			if (response.status && response.status == 200) {
				var data = JSON.parse(response.responseText);

				var array = [];

				data.sort((a,b) => b.score - a.score)
					.forEach(function(d){
						array.push(d);
					});

//				console.log(data);
				drawWinners(array);


			}
		}
	});


//
//
//	d3.csv('dummywinners.csv', function(e,data){
//		var array = [];
//		data.forEach(function(row){
//			if(row.name && row.score) {
//				array.push(row);
//			}
//		});
//		array.sort((a,b) => b.score - a.score);
//		drawWinners(array);
//	});

}

var formDrawnFlag = false;

function drawWinners(data){
	console.log(data);
	var winners = d3.select("#winners");
	data.forEach(function(row){
		if(!formDrawnFlag && score > row.score) {
			drawForm(winners);
		}

		var tr = winners.append("tr").datum(row);
		tr.append("td").html(row.name);
		tr.append("td").html(row.school);
		tr.append("td").html(row.score);

	});
	if(!formDrawnFlag && score != 0) {
		drawForm(winners);
	}
}


function drawForm(winners){
	formDrawnFlag = true;
	var formTR = winners.append("tr");

	formTR.append("td").append("input").attrs({
		id: "focusHerePlease",
		placeholder: "Enter Your Name"
	}).on("keydown", function(){
		if(d3.event.code == "Enter") {
			document.getElementById("nowfocusHerePlease").focus();
		}
	});
	formTR.append("td").append("input").attrs({
		id: "nowfocusHerePlease",
		placeholder: "Enter Your School Email"
	}).on("keydown", function(){
		if(d3.event.code == "Enter") {
			submitScore();
		}
	});

	formTR.append("td").html(score);

	formTR.append("td").attrs({
		id: "submitButtonBox"
	}).append("a").attrs({
		id: "submitScoreButton",
		href:"#submit"
	}).html("Submit").on("click",function(){
		console.log("submitting!!!");
		submitScore();
	});

	document.getElementById("focusHerePlease").focus();
}


function submitScore() {
	var school = "GovHack School of Hard Knocks";

	var package = {
		name: $("#focusHerePlease").val(),
		school: school,
		email: $("#nowfocusHerePlease").val(),
		score: score
	};

	$.ajax({
		type: "POST",
		url: "http://www.masteryourcensus.space/api/leaderboard.php",
//		contentType: "text/plain",
		dataType: "json",
		data: JSON.stringify(package),
		complete: function(response){
			if (response.status && response.status == 200) {
				var data = JSON.parse(response.responseText);


				alert("Your score has been entered!");
				location.reload();

			}
		}
	});
}

//https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
function shuffle(array) {
	var currentIndex = array.length, temporaryValue, randomIndex;

	// While there remain elements to shuffle...
	while (0 !== currentIndex) {

		// Pick a remaining element...
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;

		// And swap it with the current element.
		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}

	return array;
}


</script>



</body>
</html>



































































